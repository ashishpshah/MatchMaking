@model ResponseModel<ForgotPassword>
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Forgot Password - MatchMaking</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- App favicon -->
    <link rel="shortcut icon" href="~/Admin/assets/images/favicon.ico">

    <!-- Theme Config Js -->
    <script src="~/Admin/assets/js/config.js"></script>
    <link href="~/Admin/assets/vendor/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <link href="~/Admin/assets/css/app.min.css" rel="stylesheet" type="text/css" id="app-style" />
    <link href="~/Admin/assets/css/icons.min.css" rel="stylesheet" type="text/css" />
</head>

<body class="authentication-bg position-relative">

    <div class="account-pages pt-2 pt-sm-5 pb-4 pb-sm-5 position-relative">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xxl-8 col-lg-10">
                    <div class="card overflow-hidden">
                        <div class="row g-0">

                            <!-- LEFT IMAGE -->
                            <div class="col-lg-6 d-none d-lg-block p-2">
                                <img src="~/Admin/assets/images/auth-img.jpg"
                                     alt="" class="img-fluid rounded h-100">
                            </div>

                            <!-- RIGHT FORM AREA -->
                            <div class="col-lg-6">
                                <div class="d-flex flex-column h-100">
                                    <div class="auth-brand p-4 text-center">
                                        <a class="logo-light">
                                            <img src="~/Admin/assets/images/leozlogo.jpeg" height="125" />
                                        </a>
                                        <a class="logo-dark">
                                            <img src="~/Admin/assets/images/leozlogo.jpeg" height="125" />
                                        </a>
                                    </div>
                                    <div class="p-4 my-auto">
                                        <div id="forgotPasswordContainer">

                                            <!-- STEP 1: Enter Email -->
                                            <div id="fp_step1">
                                                <h4 class="fs-20 mb-2">Forgot Password</h4>
                                                <p class="text-muted">Enter your registered email address</p>

                                                <div class="mb-3">
                                                    <label>Email</label>
                                                    <input type="email" id="fp_email"
                                                           class="form-control" placeholder="Enter email" />
                                                </div>

                                                <button id="fp_btn_sendotp"
                                                        class="btn btn-soft-primary w-100">
                                                    Send OTP
                                                </button>

                                                <div id="fp_msg1" class="mt-2 text-danger"></div>
                                            </div>


                                            <!-- STEP 2: OTP -->
                                            <div id="fp_step2" style="display:none;">
                                                <h4 class="fs-20 mb-2">Verify OTP</h4>

                                                <div class="mb-3">
                                                    <label>Enter OTP</label>
                                                    <input type="text" id="fp_otp" maxlength="6"
                                                           class="form-control" placeholder="Enter 6-digit OTP" />
                                                </div>
                                                <!-- TIMER TEXT -->
                                                <div class="text-info mb-2" id="fp_timerBlock">
                                                   Resend OTP in: <span id="fp_timer">00:10</span>
                                                </div>
                                                <!-- RESEND OTP BUTTON -->
                                                <button id="fp_btn_resendotp"
                                                        class="btn btn-link p-0 mb-3"
                                                        disabled>
                                                    Resend OTP
                                                </button>

                                                <button id="fp_btn_verifyotp"
                                                        class="btn btn-success w-100">
                                                    Verify OTP
                                                </button>

                                                <div id="fp_msg2" class="mt-2 text-danger"></div>
                                            </div>


                                            
                                            <!-- STEP 3: Reset Password -->
                                            <div id="fp_step3" style="display:none;">
                                                <h4 class="fs-20 mb-2">Reset Password</h4>

                                                <div class="mb-3">
                                                    <label>New Password</label>
                                                    <input type="password" id="fp_newpassword"
                                                           class="form-control" placeholder="Enter new password" />
                                                </div>

                                                <div class="mb-3">
                                                    <label>Confirm Password</label>
                                                    <input type="password" id="fp_confirmpassword"
                                                           class="form-control" placeholder="Re-enter password" />
                                                </div>

                                                <button id="fp_btn_resetpw"
                                                        class="btn btn-success w-100">
                                                    Reset Password
                                                </button>

                                                <div id="fp_msg3" class="mt-2 text-danger"></div>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>
                            <!-- end right col -->

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="~/Admin/assets/js/vendor.min.js"></script>
    <script src="~/Admin/assets/vendor/sweetalert2/sweetalert2.min.js"></script>
    <script src="~/Admin/assets/js/app.min.js"></script>


    <script>
        let fp_countdown;
        let fp_seconds = 120; // 2 minutes

        function fp_startTimer() {
            clearInterval(fp_countdown);
            fp_seconds = 10;

            // set initial timer text immediately
            $("#fp_timer").text("02:00");

            fp_countdown = setInterval(() => {

                let m = Math.floor(fp_seconds / 60);
                let s = fp_seconds % 60;

                $("#fp_timer").text(
                    m.toString().padStart(2, '0') + ":" +
                    s.toString().padStart(2, '0')
                );

                fp_seconds--;

                if (fp_seconds < 0) {
            clearInterval(fp_countdown);
            $("#fp_btn_resendotp").prop("disabled", false); // enable resend
              $("#fp_timerBlock").hide(); // hide whole "OTP expires in:" line // hide timer
                }

            }, 1000);
        }

        // --------------------
        // SEND OTP
        // --------------------
        $("#fp_btn_sendotp").click(function () {
            var email = $("#fp_email").val().trim();
            $("#fp_msg1").html("");

            if (email === "") {
                $("#fp_msg1").html("Please enter email.");
                return;
            }

            $.post("/Admin/Home/ForgotPassword_SendOTP", { email: email }, function (res) {
                if (res.IsSuccess) {
                    $("#fp_step1").hide();
                    $("#fp_step2").show();
                    $("#fp_btn_resendotp").prop("disabled", true);
                    fp_startTimer(); // start countdown immediately
                } else {
                    $("#fp_msg1").html(res.Message);
                }
            });
        });


        // VERIFY OTP

        $("#fp_btn_verifyotp").click(function () {
            var email = $("#fp_email").val().trim();
            var otp = $("#fp_otp").val().trim();
            $("#fp_msg2").html("");

            if (otp === "") {
                $("#fp_msg2").html("Please enter OTP.");
                return;
            }

            $.post("/Admin/Home/ForgotPassword_VerifyOTP", { email: email, otp: otp }, function (res) {
                if (res.IsSuccess) {
                    clearInterval(fp_countdown); // stop timer
                    $("#fp_step2").hide();
                    $("#fp_step3").show();
                } else {
                   $("#fp_msg2").removeClass("text-success").addClass("text-danger").html(res.Message);
                }
            });
        });

        // --------------------
        // RESET PASSWORD
        // --------------------
        $("#fp_btn_resetpw").click(function () {
            var email = $("#fp_email").val().trim();
            var newPassword = $("#fp_newpassword").val().trim();
            var confirmPassword = $("#fp_confirmpassword").val().trim();
            $("#fp_msg3").html("");

            if (newPassword === "") {
                $("#fp_msg3").html("Please enter new password.");
                return;
            }
            if (confirmPassword === "") {
                $("#fp_msg3").html("Please enter confirm password.");
                return;
            }
            if (newPassword !== confirmPassword) {
                $("#fp_msg3").html("Password & Confirm Password do not match.");
                return;
            }

            $.post("/Admin/Home/ForgotPassword_ResetPassword", { email: email, newPassword: newPassword }, function (res) {
                if (res.IsSuccess) {
                    $("#fp_msg3").removeClass("text-danger").addClass("text-success").html("Password changed successfully. Redirecting...");
                    setTimeout(function () { window.location.href = "/Admin/Home/Account"; }, 1500);
                } else {
                    $("#fp_msg3").html(res.Message);
                }
            });
        });

        // --------------------
        // RESEND OTP
        // --------------------
        $("#fp_btn_resendotp").click(function () {
            var email = $("#fp_email").val().trim();

            $.post("/Admin/Home/ForgotPassword_SendOTP", { email: email }, function (res) {
                if (res.IsSuccess) {
                    $("#fp_msg2").removeClass("text-danger").addClass("text-success").html("New OTP sent to your email.");
                    $("#fp_btn_resendotp").prop("disabled", true);
                    fp_startTimer(); // restart countdown immediately
                } else {
                    $("#fp_msg2").removeClass("text-success").addClass("text-danger").html(res.Message);
                }
            });
        });
    </script>


</body>

</html>
